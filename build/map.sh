wget http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/ne_50m_populated_places.zip
wget http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/ne_50m_admin_0_countries.zip

unzip ne_50m_populated_places.zip 
unzip ne_50m_admin_0_countries.zip

ogr2ogr -f GeoJSON -where "(continent='Europe' OR subregion ='Western Asia') AND type IN ('Sovereign country','Country')" ne_50m_admin_0_countries.json ne_50m_admin_0_countries.shp

topojson --id-property iso_a2 -p name,iso3=iso_a3 --simplify-proportion .3 -o countries.json countries=ne_50m_admin_0_countries.json

# ogrinfo ne_50m_admin_0_countries.shp  -so ne_50m_admin_0_countries
#generated by node isolist.js
countries_list="'AL','AX','AD','AE','AM','AT','AZ','BE','BG','BH','BA','BY','CH','CY','CZ','DE','DK','ES','EE','FI','FR','GB','GE','GG','GR','HR','HU','IM','IE','IQ','IS','IL','IT','JE','JO','KW','LB','LI','LT','LU','LV','MC','MD','MK','MT','ME','NL','NO','OM','PL','PT','QA','RO','RU','SA','SM','RS','SK','SI','SE','SY','TR','UA','VA','YE'"

ogr2ogr -f GeoJSON -where "ISO_A2 IN ($countries_list) AND SCALERANK < 8" ne_50m_populated_places.json ne_50m_populated_places.shp

topojson -p name=NAME,iso=ISO_A2,rank=SCALERANK,type=FEATURECLA -o places.tmp places=ne_50m_populated_places.json 
sed  -e 's/Admin-0 //g;s/Admin-1 //g;s/region capital/region_capital/g;s/Populated place//g' places.tmp > places.json

